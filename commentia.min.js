var api="api.php";var pageid=document.getElementsByTagName("html")[0].getAttribute("data-pageid");function httpRequest(){try{http_request=new XMLHttpRequest();return http_request}catch(a){try{http_request=new ActiveXObject("Msxml2.XMLHTTP");return http_request}catch(a){try{http_request=new ActiveXObject("Microsoft.XMLHTTP");return http_request}catch(a){alert("Your browser broke!");return false}}}}function refreshComments(){var b=document.getElementById("comments_pageid-"+pageid);var a=api+"?pageid="+pageid+"&action=display";var c=httpRequest();console.log("GET request to: "+a);c.onreadystatechange=function(){if(c.readyState==4){b.innerHTML=c.responseText;c=null}};c.open("GET",a,true);c.send()}function showReplyArea(e){var h=findCommentRoot(e);var b=h.getAttribute("data-ucid");var f="reply-area-"+b;var a="reply-box-"+b;var g="reply-button-"+b;var d="edit-cancel-button-"+b;if(!document.getElementById(f)){var k=document.createElement("div");k.setAttribute("id",f);var c=document.createElement("textarea");c.setAttribute("id",a);c.setAttribute("oninput","autoGrow(this);");k.appendChild(c);var i=document.createElement("button");i.innerHTML="reply";i.setAttribute("id",g);i.setAttribute("onclick","postReply(this);");k.appendChild(i);var j=document.createElement("button");j.innerHTML="cancel";j.setAttribute("id",d);j.setAttribute("onclick","hideReplyArea(this);");k.appendChild(j);h.getElementsByClassName("commentia-reply_area")[0].appendChild(k)}document.getElementById(f).style.display="block"}function hideReplyArea(b){var d=findCommentRoot(b);var a=d.getAttribute("data-ucid");var c="reply-area-"+a;document.getElementById(c).style.display="none"}function findCommentRoot(a){while((a=a.parentNode)&&!a.hasAttribute("data-ucid")){}return a}function postReply(e){var g=findCommentRoot(e);var c=g.getAttribute("data-ucid");var i=g.getAttribute("data-reply-path");var b="reply-box-"+c;var d=document.getElementById("comments_pageid-"+pageid);var h=encodeURI(document.getElementById(b).value);var f="pageid="+pageid+"&action=reply&content="+h+"&reply_path="+i+"&username=user0";console.log("POST request to: "+api+" with params: "+f);var a=httpRequest();a.onreadystatechange=function(){if(a.readyState==4){refreshComments();a=null}};a.open("POST",api,true);a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.send(f)}function postNewComment(a){var f="comment-box";var c=document.getElementById("comments_pageid-"+pageid);var b=encodeURI(document.getElementById(f).value);var d="pageid="+pageid+"&action=postNewComment&content="+b+"&username=user0";var e=httpRequest();console.log("POST request to: "+api+" with params: "+d);e.onreadystatechange=function(){if(e.readyState==4){refreshComments();e=null}};e.open("POST",api,true);e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.send(d)}function deleteComment(b){if(confirm("Are you sure that you want to delete this comment?")){var c=document.getElementById("comments_pageid-"+pageid);var g=findCommentRoot(b);var a=g.getAttribute("data-ucid");var e=g.getAttribute("data-reply-path");var d="pageid="+pageid+"&action=delete&ucid="+a+"&reply_path="+e;console.log("POST request to: "+api+" with params: "+d);var f=httpRequest();f.onreadystatechange=function(){if(f.readyState==4){refreshComments();f=null}};f.open("POST",api,true);f.setRequestHeader("Content-type","application/x-www-form-urlencoded");f.send(d)}}function showEditArea(g){var i=findCommentRoot(g);var c=i.getAttribute("data-ucid");var l=i.getAttribute("data-reply-path");var k="edit-area-"+c;var j="edit-box-"+c;var f="edit-button-"+c;var e="edit-cancel-button-"+c;if(!document.getElementById(k)){var h=document.createElement("div");h.setAttribute("id",k);var n=document.createElement("textarea");n.setAttribute("id",j);n.setAttribute("oninput","autoGrow(this);");var b=api+"?pageid="+pageid+"&action=getCommentMarkdown&ucid="+c+"&reply_path="+l;var a=httpRequest();console.log("GET request to: "+b);a.onreadystatechange=function(){if(a.readyState==4){i.getElementsByClassName("commentia-comment_content")[0].style.display="none";i.getElementsByClassName("commentia-edit_area")[0].appendChild(h);i.getElementsByClassName("commentia-edit_area")[0].style.display="block";n.innerHTML=a.responseText;document.getElementById(j).style.height=document.getElementById(j).scrollHeight+"px";a=null}};a.open("GET",b,true);a.send();h.appendChild(n);var d=document.createElement("button");d.innerHTML="edit";d.setAttribute("id",f);d.setAttribute("onclick","editComment(this);");h.appendChild(d);var m=document.createElement("button");m.innerHTML="cancel";m.setAttribute("id",e);m.setAttribute("onclick","hideEditArea(this);");h.appendChild(m)}else{i.getElementsByClassName("commentia-comment_content")[0].style.display="none";i.getElementsByClassName("commentia-edit_area")[0].style.display="block"}}function hideEditArea(a){var b=findCommentRoot(a);b.getElementsByClassName("commentia-edit_area")[0].style.display="none";b.getElementsByClassName("commentia-comment_content")[0].style.display="block"}function editComment(b){var g=findCommentRoot(b);var a=g.getAttribute("data-ucid");var c=document.getElementById("edit-box-"+a);var e=g.getAttribute("data-reply-path");var d="pageid="+pageid+"&action=edit&content="+encodeURI(c.value)+"&ucid="+a+"&reply_path="+e;var f=httpRequest();console.log("POST request to: "+api+" with params: "+d);f.onreadystatechange=function(){if(f.readyState==4){refreshComments();f=null}};f.open("POST",api,true);f.setRequestHeader("Content-type","application/x-www-form-urlencoded");f.send(d)}function autoGrow(a){a.style.height="auto";a.style.height=(a.scrollHeight+5)+"px"};
